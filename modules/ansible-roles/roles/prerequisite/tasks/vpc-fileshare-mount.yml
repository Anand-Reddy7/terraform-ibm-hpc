---
- name: Create base directory for NFS mount
  file:
    path: /mnt/lsf/shared
    state: directory
    mode: '0777'

- name: Set permissions for shared directory
  file:
    path: /mnt/lsf/shared
    state: directory
    mode: '0777'
    recurse: yes

- name: Add NFS entry to /etc/fstab
  lineinfile:
    path: /etc/fstab
    line: "10.10.20.7:/10fb2beb_aceb_4a0d_97de_c02cd425cd80 /mnt/lsf nfs rw,sec=sys,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,_netdev 0 0"
    state: present
    create: yes
  notify: Mount NFS

- name: Mount all filesystems
  command: mount -a
  register: mount_output
  changed_when: mount_output.rc == 0

- name: Verify mounted filesystems
  command: df -h
  register: df_output
  changed_when: false
  failed_when: df_output.rc != 0

- name: Check directory listing
  command: ls -ltr /mnt/lsf
  register: ls_output
  changed_when: false
  failed_when: ls_output.rc != 0