---
- name: Git Clone and Terraform Apply
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Clone Git repository
      git:
        repo: "{{ var.git_repository }}"
        dest: /tmp/git_repo
        force: yes

    - name: Change to the Git repository directory
      become: yes
      shell: cd /tmp/git_repo
      args:
        executable: /bin/bash

    - name: Run Terraform init
      become: yes
      shell: terraform init
      args:
        executable: /bin/bash
      register: init_result

    - name: Check Terraform init output
      debug:
        var: init_result.stdout
      when: init_result.rc == 0

    - name: Run Terraform apply
      become: yes
      shell: terraform apply -auto-approve
      args:
        executable: /bin/bash
      register: apply_result

    - name: Check Terraform apply output
      debug:
        var: apply_result.stdout
      when: apply_result.rc == 0
